<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√°dio Online</title>
    <style>
        :root {
    --primary-color: #4f46e5;
    --primary-hover: #6366f1;
    --primary-light: #1e1b4b;
    --secondary-color: #e2e8f0;
    --accent-color: #f43f5e;
    --text-color: #e2e8f0;
    --text-light: #94a3b8;
    --light-bg: #0f172a;
    --card-bg: #1e293b;
    --border-color: #334155;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.25);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.35);
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-full: 9999px;
    --transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

body {
    background-color: var(--light-bg);
    color: var(--text-color);
    line-height: 1.6;
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

header {
    background-color: #1e1b4b;
    background-image: linear-gradient(135deg, #1e1b4b, #4338ca);
    color: white;
    padding: 1.25rem 2rem;
    box-shadow: var(--shadow-md);
    position: sticky;
    top: 0;
    z-index: 100;
}

.container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 1.5rem;
}

.search-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
    background-color: var(--card-bg);
    padding: 1.25rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
}

.search-box {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    position: relative;
}

input, select, button {
    padding: 0.875rem 1.25rem;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    font-size: 1rem;
    transition: all var(--transition);
    outline: none;
}

input {
    flex: 1;
    min-width: 200px;
    box-shadow: var(--shadow-sm);
    background-color: #0f172a;
    color: var(--text-color);
}

input:focus, select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
}

button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    cursor: pointer;
    transition: background-color var(--transition), transform var(--transition);
    white-space: nowrap;
    font-weight: 500;
    box-shadow: var(--shadow-sm);
}

button:hover {
    background-color: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

button:active {
    transform: translateY(0);
}

.filter-container {
    display: flex;
    gap: 1.25rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    background-color: var(--card-bg);
    padding: 1.25rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
}

.filter-group {
    flex: 1;
    min-width: 200px;
}

.filter-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--text-light);
    font-size: 0.875rem;
}

select {
    width: 100%;
    background-color: #0f172a;
    color: var(--text-color);
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1.25rem;
    padding-right: 2.5rem;
}

.radio-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
}

.radio-card {
    background-color: var(--card-bg);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    transition: transform var(--transition), box-shadow var(--transition);
    position: relative;
    border: 1px solid var(--border-color);
}

.radio-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.radio-image {
    height: 180px;
    background-color: #0f172a;
    background-image: linear-gradient(45deg, #0f172a, #1e293b);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3rem;
    overflow: hidden;
    position: relative;
}

.radio-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition);
}

.radio-card:hover .radio-image img {
    transform: scale(1.05);
}

.radio-info {
    padding: 1.25rem;
}

.radio-name {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--secondary-color);
}

.radio-details {
    font-size: 0.9rem;
    color: var(--text-light);
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
}

.radio-details span {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.75rem;
}

.tag {
    background-color: var(--primary-light);
    color: #a5b4fc;
    padding: 0.25rem 0.625rem;
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 500;
}

.play-button {
    position: absolute;
    bottom: 1.25rem;
    right: 1.25rem;
    width: 48px;
    height: 48px;
    border-radius: var(--radius-full);
    background-color: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: var(--shadow-md);
    transition: all var(--transition);
}

.play-button:hover {
    background-color: var(--primary-hover);
    transform: scale(1.1);
}

.play-button svg {
    width: 24px;
    height: 24px;
    fill: white;
}

.player-container {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #0f172a;
    color: white;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 100;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
}

.player-container.active {
    transform: translateY(0);
}

.now-playing {
    display: flex;
    align-items: center;
    gap: 1.25rem;
}

.station-logo {
    width: 60px;
    height: 60px;
    background-color: var(--primary-color);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.station-logo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.station-info {
    flex: 1;
}

.station-info h3 {
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.station-info p {
    color: #94a3b8;
    font-size: 0.875rem;
}

.player-controls {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.control-button {
    background-color: rgba(255, 255, 255, 0.1);
    color: white;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition);
}

.control-button:hover {
    background-color: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

.control-button.play-pause {
    width: 48px;
    height: 48px;
    background-color: var(--primary-color);
}

.control-button.play-pause:hover {
    background-color: var(--primary-hover);
}

.volume-control {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background-color: rgba(255, 255, 255, 0.1);
    padding: 0.5rem 1rem;
    border-radius: var(--radius-full);
}

.volume-slider {
    width: 100px;
    appearance: none;
    height: 4px;
    border-radius: var(--radius-full);
    background-color: rgba(255, 255, 255, 0.2);
    outline: none;
}

.volume-slider::-webkit-slider-thumb {
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: white;
    cursor: pointer;
}

.loading {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 300px;
    flex-direction: column;
    gap: 1rem;
}

.spinner {
    width: 48px;
    height: 48px;
    border: 3px solid rgba(79, 70, 229, 0.1);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading p {
    color: var(--text-light);
    font-weight: 500;
}

.no-results {
    text-align: center;
    padding: 3rem;
    color: var(--text-light);
    background-color: var(--card-bg);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
}

.no-results svg {
    width: 64px;
    height: 64px;
    margin-bottom: 1rem;
    color: var(--text-light);
    opacity: 0.5;
}

.no-results h3 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.pagination {
    display: flex;
    justify-content: center;
    margin-top: 2.5rem;
    gap: 0.5rem;
}

.pagination button {
    padding: 0.625rem 1rem;
    min-width: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
}

.pagination button.active {
    background-color: #0f172a;
    color: white;
}

.pagination button:disabled {
    background-color: #334155;
    color: #64748b;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

@media (max-width: 768px) {
    .search-container, .filter-container {
        flex-direction: column;
        padding: 1rem;
    }
    
    .radio-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
    
    .player-container {
        flex-direction: column;
        gap: 1.25rem;
        padding: 1.25rem 1rem;
    }
    
    .station-info {
        text-align: center;
        margin-bottom: 0.5rem;
    }
    
    .now-playing {
        flex-direction: column;
        width: 100%;
    }
    
    .player-controls {
        width: 100%;
        justify-content: center;
    }
    
    .volume-control {
        margin-top: 0.5rem;
    }
}
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>R√°dio Online</h1>
        </div>
    </header>

    <main class="container">
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Pesquisar esta√ß√µes...">
                <button id="search-button">Pesquisar</button>
            </div>
            <div>
                <button id="favorites-button">Favoritos</button>
            </div>
        </div>

    <div class="filter-container">
    <div class="filter-group">
        <label for="country-filter">Pa√≠s:</label>
        <select id="country-filter">
            <option value="">Todos os Pa√≠ses</option>
        </select>
    </div>
    <div class="filter-group">
        <label for="language-filter">Idioma:</label>
        <select id="language-filter">
            <option value="">Todos os Idiomas</option>
        </select>
    </div>
    <div class="filter-group">
        <label for="tag-filter">G√™nero:</label>
        <select id="tag-filter">
            <option value="">Todos os G√™neros</option>
        </select>
    </div>

            <div class="filter-group">
                <label for="sort-options">Ordenar por:</label>
                <select id="sort-options">
                    <option value="name">Nome (A-Z)</option>
                    <option value="votes">Mais Votadas</option>
                    <option value="clicks">Mais Populares</option>
                    <option value="bitrate">Melhor Qualidade</option>
                </select>
            </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Carregando...</p>
        </div>

        <div id="radio-grid" class="radio-grid"></div>

        <div id="pagination" class="pagination"></div>
        </main>

    <div id="player" class="player-container">
        <div class="now-playing">
            <div class="station-logo">
                <i class="radio-icon">üìª</i>
            </div>
            <div class="station-info">
                <h3 id="current-station">Nome da Esta√ß√£o</h3>
                <p id="current-info">Pa√≠s - G√™nero</p>
            </div>
        </div>
        <div class="player-controls">
            <button class="control-button" id="stop-button">‚èπÔ∏è</button>
            <button class="control-button play-pause" id="play-pause-button">‚ñ∂Ô∏è</button>
            <div class="volume-control">
                <span>üîä</span>
                <input type="range" id="volume" min="0" max="1" step="0.1" value="0.7">
            </div>
        </div>
        <audio id="audio-player"></audio>
    </div>

    <script>
        const API_BASE_URL = 'https://de1.api.radio-browser.info/json';
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const favoritesButton = document.getElementById('favorites-button');
        const countryFilter = document.getElementById('country-filter');
        const languageFilter = document.getElementById('language-filter');
        const tagFilter = document.getElementById('tag-filter');
        const sortOptions = document.getElementById('sort-options');
        const radioGrid = document.getElementById('radio-grid');
        const loading = document.getElementById('loading');
        const pagination = document.getElementById('pagination');
        const player = document.getElementById('player');
        const audioPlayer = document.getElementById('audio-player');
        const currentStation = document.getElementById('current-station');
        const currentInfo = document.getElementById('current-info');
        const stopButton = document.getElementById('stop-button');
        const volumeControl = document.getElementById('volume');
        const playPauseButton = document.getElementById('play-pause-button');


        let currentPage = 1;
        let itemsPerPage = 20;
        let totalStations = 0;
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let showingFavorites = false;
        let stations = []; // Array global para armazenar as esta√ß√µes
        let currentStationIndex = 0; //√çndice da esta√ß√£o atual

        const filters = {
            name: '',
            country: '',
            language: '',
            tagList: '', // Inicializado como vazio
            order: 'name',
            reverse: false,
            offset: 0,
            limit: itemsPerPage,
            hidebroken: true
        };


        async function fetchData(endpoint, params = {}) {
            try {
                const url = new URL(`${API_BASE_URL}${endpoint}`);
                Object.entries(params).forEach(([key, value]) => {
                    if (value !== undefined && value !== null && value !== '') {
                        url.searchParams.append(key, value);
                    }
                });

                const response = await fetch(url, {
                    headers: {
                        'User-Agent': 'RadioOnlineWebApp/1.0'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    const message = `Erro na requisi√ß√£o da API (${response.status}): ${errorText}`;
                    throw new Error(message);
                }

                return await response.json();
            } catch (error) {
                console.error('Erro ao buscar dados:', error);
                handleError(error); //Fun√ß√£o para exibir mensagem de erro
                return [];
            }
        }

        function handleError(error) {
    console.error(error);
    // Only show alert for non-playback errors
    if (!error.message.includes('play')) {
        alert(`Error: ${error.message}`);
    }
}

audioPlayer.onerror = (e) => {
    const playNext = confirm(`This station is not working. Would you like to try the next station?`);
    if (playNext) {
        playNextStation();
    } else {
        stopButton.click(); // Stop playback if user doesn't want to continue
    }
};

        async function loadFilters() {
            try {
                const [countries, languages, tags] = await Promise.all([
                    fetchData('/countries'),
                    fetchData('/languages'),
                    fetchData('/tags')
                ]);

                populateSelect(countryFilter, countries, 'name');
                populateSelect(languageFilter, languages, 'name');
                populateSelect(tagFilter, tags.filter(tag => tag.name.trim() !== '' && tag.stationcount > 5).sort((a, b) => b.stationcount - a.stationcount).slice(0, 50), 'name');
                //tagFilter.multiple = true;

            } catch (error) {
                handleError(error);
            }
        }

        function populateSelect(selectElement, data, valueProperty) {
            selectElement.innerHTML = '';
            const firstOption = document.createElement('option');
            firstOption.value = '';
            firstOption.textContent = 'Todos';
            selectElement.appendChild(firstOption);

            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item[valueProperty];
                option.textContent = item[valueProperty] + (item.stationcount ? ` (${item.stationcount})` : '');
                selectElement.appendChild(option);
            });
        }


        async function searchStations() {
            showLoading(true);
            radioGrid.innerHTML = '';

            if (showingFavorites) {
                displayFavorites();
                return;
            }

            try {
                const countResponse = await fetchData('/stations/search', { ...filters, limit: 100000 });
                totalStations = countResponse.length;
                const stationsData = await fetchData('/stations/search', filters);
                stations = stationsData;
                currentStationIndex = 0;

                if (stations.length === 0) {
                    showNoResultsMessage('Nenhuma esta√ß√£o encontrada. Tente ajustar seus filtros de pesquisa.');
                } else {
                    displayStations(stations);
                    updatePagination();
                }
            } catch (error) {
                showNoResultsMessage('Erro ao buscar esta√ß√µes. Por favor, tente novamente mais tarde.');
            } finally {
                showLoading(false);
            }
        }

        function showNoResultsMessage(message) {
            radioGrid.innerHTML = `
                <div class="no-results">
                    <h3>${message}</h3>
                </div>
            `;
        }


        function displayStations(stations) {
            radioGrid.innerHTML = '';
            stations.forEach(station => {
                const card = createStationCard(station);
                radioGrid.appendChild(card);
            });
        }


        function displayFavorites() {
            radioGrid.innerHTML = '';
            showLoading(true);

            if (favorites.length === 0) {
                showNoResultsMessage('Nenhuma esta√ß√£o favorita. Adicione esta√ß√µes aos favoritos clicando no √≠cone de cora√ß√£o.');
                showLoading(false);
                return;
            }

            fetchFavoriteStations();
        }


        async function fetchFavoriteStations() {
            try {
                const stations = await fetchData('/stations/byuuid', { uuids: favorites.join(',') });
                displayStations(stations);
            } catch (error) {
                showNoResultsMessage('Erro ao buscar favoritos. Por favor, tente novamente mais tarde.');
            } finally {
                showLoading(false);
            }
        }


        function createStationCard(station) {
            const card = document.createElement('div');
            card.className = 'radio-card';

            const isFavorite = favorites.includes(station.stationuuid);
            const favoriteClass = isFavorite ? 'favorite active' : 'favorite';
            const favoriteIcon = isFavorite ? '‚ù§Ô∏è' : 'ü§ç';

            const tags = station.tags ? station.tags.split(',').slice(0, 3).map(tag => `<span class="tag">${tag.trim()}</span>`).join('') : '';

            card.innerHTML = `
                <div class="radio-image">
                    ${station.favicon ? `<img src="${station.favicon}" alt="${station.name}" onerror="this.onerror=null; this.src='/api/placeholder/300/150'; this.parentElement.innerHTML='üìª';">` : 'üìª'}
                </div>
                <div class="radio-info">
                    <h3 class="radio-name">${station.name}</h3>
                    <div class="radio-details">
                        <span>${station.country || 'Pa√≠s Desconhecido'}</span>
                        <span>${station.language || 'Idioma Desconhecido'}</span>
                        <div class="tags">${tags}</div>
                    </div>
                    <button class="${favoriteClass}" data-uuid="${station.stationuuid}">${favoriteIcon}</button>
                </div>
                <div class="play-button" data-url="${station.url_resolved || station.url}" data-name="${station.name}" data-info="${station.country} - ${station.tags?.split(',')[0] || 'Sem g√™nero'}">‚ñ∂Ô∏è</div>
            `;

            const playButton = card.querySelector('.play-button');
            playButton.addEventListener('click', () => {
                playStation(playButton.dataset.url, playButton.dataset.name, playButton.dataset.info);
            });

            const favoriteButton = card.querySelector('.favorite');
            favoriteButton.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(station.stationuuid, favoriteButton);
            });

            return card;
        }


        function playStation(url, name, info) {
    audioPlayer.src = url;
    audioPlayer.volume = volumeControl.value;
    audioPlayer.onended = playNextStation;
    audioPlayer.play()
        .then(() => {
            currentStation.textContent = name;
            currentInfo.textContent = info;
            player.classList.add('active');
            playPauseButton.textContent = '‚è∏Ô∏è';
            trackStationClick(url);
        })
        .catch(error => {
            const playNext = confirm(`Error playing ${name}. Voc√™ gostaria de experimentar a pr√≥xima esta√ß√£o??`);
            if (playNext) {
                playNextStation();
            } else {
                stopButton.click(); // Pare a reprodu√ß√£o se o usu√°rio n√£o quiser continuar
            }
        });
}

        playPauseButton.addEventListener('click', () => {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playPauseButton.textContent = '‚è∏Ô∏è';
            } else {
                audioPlayer.pause();
                playPauseButton.textContent = '‚ñ∂Ô∏è';
            }
        });

        async function trackStationClick(url) {
            try {
                const station = await fetchData('/stations/byurl', { url });
                if (station && station.length > 0) {
                    await fetch(`${API_BASE_URL}/url/${station[0].stationuuid}`, {
                        method: 'GET',
                        headers: {
                            'User-Agent': 'RadioOnlineWebApp/1.0'
                        }
                    });
                }
            } catch (error) {
                console.error('Erro ao registrar clique:', error);
            }
        }


        function toggleFavorite(uuid, button) {
            const index = favorites.indexOf(uuid);

            if (index === -1) {
                favorites.push(uuid);
                button.textContent = '‚ù§Ô∏è';
                button.classList.add('active');
            } else {
                favorites.splice(index, 1);
                button.textContent = 'ü§ç';
                button.classList.remove('active');

                if (showingFavorites) {
                    const card = button.closest('.radio-card');
                    card.remove();

                    if (favorites.length === 0) {
                        displayFavorites();
                    }
                }
            }

            localStorage.setItem('favorites', JSON.stringify(favorites));
        }


        function updatePagination() {
            const totalPages = Math.ceil(totalStations / itemsPerPage);
            pagination.innerHTML = '';

            if (totalPages <= 1) return;

            const prevBtn = createPaginationButton('¬´ Anterior', () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateFilters();
                    searchStations();
                }
            });
            prevBtn.disabled = currentPage === 1;

            const nextBtn = createPaginationButton('Pr√≥ximo ¬ª', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateFilters();
                    searchStations();
                }
            });
            nextBtn.disabled = currentPage === totalPages;

            pagination.appendChild(prevBtn);

            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = createPaginationButton(i, () => {
                    currentPage = i;
                    updateFilters();
                    searchStations();
                });
                pageBtn.classList.toggle('active', i === currentPage);
                pagination.appendChild(pageBtn);
            }

            pagination.appendChild(nextBtn);
        }


        function createPaginationButton(text, onClick) {
            const button = document.createElement('button');
            button.textContent = text;
            button.addEventListener('click', onClick);
            return button;
        }


        function updateFilters() {
            const tags = tagFilter.selectedOptions.length > 0 ? Array.from(tagFilter.selectedOptions).map(option => option.value).join(',') : '';

            filters.name = searchInput.value;
            filters.country = countryFilter.value;
            filters.language = languageFilter.value;
            filters.tagList = tags; // Atualiza tagList com as tags selecionadas
            filters.order = sortOptions.value;
            filters.reverse = sortOptions.value === 'votes' || sortOptions.value === 'clicks' || sortOptions.value === 'bitrate';
            filters.offset = (currentPage - 1) * itemsPerPage;
            filters.limit = itemsPerPage;
            filters.hidebroken = true;
        }


        function showLoading(show) {
            loading.style.display = show ? 'flex' : 'none';
        }


        searchButton.addEventListener('click', () => {
            currentPage = 1;
            updateFilters();
            searchStations();
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                currentPage = 1;
                updateFilters();
                searchStations();
            }
        });


        favoritesButton.addEventListener('click', () => {
            showingFavorites = !showingFavorites;
            favoritesButton.textContent = showingFavorites ? 'Todas as Esta√ß√µes' : 'Favoritos';
            currentPage = 1;

            if (showingFavorites) {
                displayFavorites();
                pagination.style.display = 'none';
            } else {
                updateFilters();
                searchStations();
                pagination.style.display = 'flex';
            }
        });


        [countryFilter, languageFilter, tagFilter, sortOptions].forEach(filter => {
            filter.addEventListener('change', () => {
                if (!showingFavorites) {
                    currentPage = 1;
                    updateFilters();
                    searchStations();
                }
            });
        });


        stopButton.addEventListener('click', () => {
            audioPlayer.pause();
            audioPlayer.src = '';
            player.classList.remove('active');
            playPauseButton.textContent = '‚ñ∂Ô∏è'; //Resetar o bot√£o play/pause
        });


        volumeControl.addEventListener('input', () => {
            audioPlayer.volume = volumeControl.value;
        });


        audioPlayer.onerror = () => {
            handleError(new Error('Erro ao reproduzir a esta√ß√£o.'));
            playNextStation();
        };


        window.addEventListener('load', () => {
            loadFilters();
            updateFilters();
            searchStations();
        });


        async function playNextStation() {
            if (stations && stations.length > currentStationIndex + 1) {
                currentStationIndex++;
                const nextStation = stations[currentStationIndex];
                playStation(nextStation.url_resolved || nextStation.url, nextStation.name, `${nextStation.country} - ${nextStation.tags?.split(',')[0] || 'Sem g√™nero'}`);
            } else {
                alert('Acabaram as esta√ß√µes na lista.');
                player.classList.remove('active');
                playPauseButton.textContent = '‚ñ∂Ô∏è'; //Resetar o bot√£o play/pause
                currentStationIndex = 0;
            }
        }
    </script>
</body>
</html>
