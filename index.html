<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√°dio Online Avan√ßada</title>
    <!-- Favicon com Emoji (pode substituir por um .ico ou .png real) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìª</text></svg>">

    <!-- Importa a fonte Inter do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Script para Lucide Icons (se voc√™ for usar) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --primary-color: #4f46e5; /* Indigo 600 */
            --primary-hover: #6366f1; /* Indigo 500 */
            --primary-light: #1e1b4b; /* Indigo 900 */
            --secondary-color: #e2e8f0; /* Slate 200 */
            --accent-color: #f43f5e; /* Rose 500 */
            --text-color: #e2e8f0; /* Slate 200 */
            --text-light: #94a3b8; /* Slate 400 */
            --light-bg: #0f172a; /* Slate 900 */
            --card-bg: #1e293b; /* Slate 800 */
            --border-color: #334155; /* Slate 700 */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.25);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.35);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-full: 9999px;
            --transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        header {
            background-color: #1e1b4b;
            background-image: linear-gradient(135deg, #1e1b4b, #4338ca);
            color: white;
            padding: 1.25rem 2rem;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .search-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
            background-color: var(--card-bg);
            padding: 1.25rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .search-box {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }

        input, select, button {
            padding: 0.875rem 1.25rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            font-size: 1rem;
            transition: all var(--transition);
            outline: none; /* Removido para acessibilidade, ser√° adicionado um foco customizado */
        }

        /* Foco customizado para acessibilidade */
        input:focus, select:focus, button:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            outline: none; /* Garante que o outline padr√£o do navegador n√£o apare√ßa */
        }

        input {
            flex: 1;
            min-width: 200px;
            box-shadow: var(--shadow-sm);
            background-color: #0f172a;
            color: var(--text-color);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color var(--transition), transform var(--transition);
            white-space: nowrap;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
            display: inline-flex; /* Para alinhar √≠cones e texto */
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        button:active {
            transform: translateY(0);
        }

        .filter-container {
            display: flex;
            gap: 1.25rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            background-color: var(--card-bg);
            padding: 1.25rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-light);
            font-size: 0.875rem;
        }

        select {
            width: 100%;
            background-color: #0f172a;
            color: var(--text-color);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.25rem;
            padding-right: 2.5rem;
        }

        /* Estilo para multi-sele√ß√£o de tags */
        select[multiple] {
            padding-right: 1.25rem; /* Remove a seta padr√£o */
            min-height: 100px; /* Altura m√≠nima para mostrar mais op√ß√µes */
            resize: vertical; /* Permite redimensionar verticalmente */
        }

        select[multiple] option {
            padding: 0.5rem 0.75rem;
        }
        select[multiple] option:checked {
            background-color: var(--primary-color);
            color: white;
        }

        .radio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .radio-card {
            background-color: var(--card-bg);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition);
            position: relative;
            border: 1px solid var(--border-color);
        }

        .radio-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        /* Destaque para a esta√ß√£o atualmente tocando */
        .radio-card.playing {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.4); /* Anel de destaque */
            transform: translateY(-3px); /* Leve levantamento */
        }

        .radio-image {
            height: 180px;
            background-color: #0f172a;
            background-image: linear-gradient(45deg, #0f172a, #1e293b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            overflow: hidden;
            position: relative;
        }

        .radio-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition);
        }

        .radio-card:hover .radio-image img {
            transform: scale(1.05);
        }

        .radio-info {
            padding: 1.25rem;
            position: relative; /* Para posicionar o bot√£o de favorito */
        }

        .radio-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--secondary-color);
        }

        .radio-details {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .radio-details span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .tag {
            background-color: var(--primary-light);
            color: #a5b4fc; /* Indigo 200 */
            padding: 0.25rem 0.625rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Bot√£o de play na card */
        .play-button {
            position: absolute;
            bottom: 1.25rem;
            right: 1.25rem;
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all var(--transition);
            /* Efeito de apari√ß√£o no hover da card */
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none; /* Desabilita o clique quando invis√≠vel */
        }

        .radio-card:hover .play-button {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .play-button:hover {
            background-color: var(--primary-hover);
            transform: scale(1.1);
        }

        .play-button svg {
            width: 24px;
            height: 24px;
            fill: white;
            stroke: white;
        }

        /* Bot√£o de favorito na card */
        .favorite {
            position: absolute;
            top: 1.25rem; /* Posi√ß√£o dentro da radio-info */
            right: 1.25rem;
            background: none;
            border: none;
            cursor: pointer;
            width: 32px;
            height: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            transition: color var(--transition), transform var(--transition);
        }

        .favorite:hover {
            transform: scale(1.2);
            color: var(--accent-color); /* Hover para cora√ß√£o vazio */
        }

        .favorite.active {
            color: var(--accent-color); /* Cor para cora√ß√£o preenchido */
        }

        .favorite svg {
            width: 24px;
            height: 24px;
            fill: currentColor; /* Preenche com a cor do bot√£o */
            stroke: currentColor; /* Contorna com a cor do bot√£o */
        }

        .favorite .icon-heart-empty { display: inline-block; }
        .favorite .icon-heart-filled { display: none; }
        .favorite.active .icon-heart-empty { display: none; }
        .favorite.active .icon-heart-filled { display: inline-block; }


        .player-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #0f172a;
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        }

        .player-container.active {
            transform: translateY(0);
        }

        .now-playing {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            flex-shrink: 0; /* Evita que encolha muito */
            min-width: 150px;
        }

        .station-logo {
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }

        .station-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .station-logo svg {
            width: 32px; /* Tamanho do √≠cone dentro do logo */
            height: 32px;
            color: white;
        }

        .station-info {
            flex: 1;
            min-width: 0; /* Permite que o texto encurte */
        }

        .station-info h3 {
            font-weight: 600;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .station-info p {
            color: #94a3b8;
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-grow: 1; /* Permite que os controles cres√ßam */
            justify-content: center; /* Centraliza os controles */
        }

        .control-button {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition);
            padding: 0;
        }

        .control-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-button svg {
            width: 24px;
            height: 24px;
            fill: white;
            stroke: white;
        }

        .control-button.play-pause {
            width: 48px;
            height: 48px;
            background-color: var(--primary-color);
        }

        .control-button.play-pause:hover {
            background-color: var(--primary-hover);
        }

        /* Controle de play/pause com SVGs */
        .play-pause .icon-play { display: inline-block; }
        .play-pause .icon-pause { display: none; }
        .play-pause.playing .icon-play { display: none; }
        .play-pause.playing .icon-pause { display: inline-block; }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            flex-shrink: 0; /* Evita que encolha muito */
        }

        .volume-control svg {
            width: 20px; /* Ajuste o tamanho do √≠cone de volume */
            height: 20px;
            fill: white;
            stroke: white;
        }

        .volume-slider {
            width: 100px;
            appearance: none;
            height: 4px;
            border-radius: var(--radius-full);
            background-color: rgba(255, 255, 255, 0.2);
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
        }

        /* Mensagens de estado */
        .loading, .no-results {
            opacity: 0;
            transition: opacity var(--transition);
            pointer-events: none; /* Impede intera√ß√£o quando invis√≠vel */
            display: flex; /* Mant√©m flex para transi√ß√£o de opacidade */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 300px; /* Altura padr√£o para ocupar espa√ßo */
            gap: 1rem;
            width: 100%;
        }

        .loading.active, .no-results.active {
            opacity: 1;
            pointer-events: auto;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(79, 70, 229, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading p {
            color: var(--text-light);
            font-weight: 500;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
            background-color: var(--card-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .no-results svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            color: var(--text-light);
            opacity: 0.5;
        }

        .no-results h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        /* Notifica√ß√£o de erro (toast) */
        .error-toast {
            position: fixed;
            bottom: 120px; /* Acima do player */
            left: 50%;
            transform: translateX(-50%) translateY(20px); /* Inicialmente um pouco para baixo e transparente */
            background-color: var(--accent-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            z-index: 200;
            opacity: 0;
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            pointer-events: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .error-toast.active {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }

        .error-toast svg {
            width: 24px;
            height: 24px;
            fill: white;
            stroke: white;
        }


        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 2.5rem;
            gap: 0.5rem;
            flex-wrap: wrap; /* Para quebrar a linha em telas pequenas */
        }

        .pagination button {
            padding: 0.625rem 1rem;
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }

        .pagination button.active {
            background-color: #0f172a; /* Cor de fundo mais escura para o bot√£o ativo */
            color: white;
            border-color: var(--primary-color);
        }

        .pagination button:disabled {
            background-color: #334155;
            color: #64748b;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 768px) {
            .search-container, .filter-container {
                flex-direction: column;
                padding: 1rem;
            }
            .search-box {
                width: 100%;
                flex-direction: column;
                gap: 1rem;
            }
            .search-box input, .search-box button {
                width: 100%;
            }
            .search-container > div:last-child {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                width: 100%;
                justify-content: center;
            }
            .radio-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .player-container {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
                align-items: flex-start;
            }

            .now-playing {
                width: 100%;
                justify-content: center;
                flex-direction: column;
                text-align: center;
                gap: 0.75rem;
            }

            .station-logo {
                width: 50px;
                height: 50px;
            }

            .player-controls {
                width: 100%;
                justify-content: center;
                gap: 1rem;
            }

            .volume-control {
                width: 100%;
                justify-content: center;
                margin-top: 0.5rem;
                padding: 0.5rem;
            }
            .volume-slider {
                flex: 1; /* Ocupa o espa√ßo restante */
            }
            .error-toast {
                width: calc(100% - 2rem);
                bottom: 100px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>R√°dio Online</h1>
        </div>
    </header>

    <main class="container">
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Pesquisar esta√ß√µes..." aria-label="Campo de pesquisa de esta√ß√µes">
                <button id="search-button" aria-label="Pesquisar esta√ß√µes">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    Pesquisar
                </button>
            </div>
            <div>
                <button id="favorites-button" aria-label="Alternar para esta√ß√µes favoritas">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                    Favoritos
                </button>
                <button id="clear-filters-button" aria-label="Limpar todos os filtros de pesquisa">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-filter-x"><path d="M2.5 2H22l-8 10V21"/><path d="m17 13 5 5m0-5-5 5"/></svg>
                    Limpar Filtros
                </button>
            </div>
        </div>

        <div class="filter-container">
            <div class="filter-group">
                <label for="country-filter">Pa√≠s:</label>
                <select id="country-filter" aria-label="Filtrar esta√ß√µes por pa√≠s">
                    <option value="">Todos os Pa√≠ses</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="language-filter">Idioma:</label>
                <select id="language-filter" aria-label="Filtrar esta√ß√µes por idioma">
                    <option value="">Todos os Idiomas</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="tag-filter">G√™nero:</label>
                <select id="tag-filter" multiple aria-label="Filtrar esta√ß√µes por g√™nero (m√∫ltipla sele√ß√£o)">
                    <option value="">Todos os G√™neros</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="sort-options">Ordenar por:</label>
                <select id="sort-options" aria-label="Ordenar resultados por">
                    <option value="name">Nome (A-Z)</option>
                    <option value="votes">Mais Votadas</option>
                    <option value="clicks">Mais Populares</option>
                    <option value="bitrate">Melhor Qualidade</option>
                </select>
            </div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Carregando esta√ß√µes...</p>
        </div>

        <div id="radio-grid" class="radio-grid"></div>

        <div id="pagination" class="pagination"></div>
    </main>

    <div id="player" class="player-container">
        <div class="now-playing">
            <div class="station-logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radio"><circle cx="12" cy="12" r="2"/><path d="M4.93 19.07A10 10 0 0 1 12 22v-2A8 8 0 0 0 6.34 17.66"/><path d="M19.07 4.93A10 10 0 0 1 12 2v2A8 8 0 0 0 17.66 6.34"/><path d="M4.93 4.93A16 16 0 0 1 12 2v2A14 14 0 0 0 6.34 6.34"/><path d="M19.07 19.07A16 16 0 0 0 12 22v-2A14 14 0 0 1 17.66 17.66"/></svg>
            </div>
            <div class="station-info">
                <h3 id="current-station">Nenhuma esta√ß√£o tocando</h3>
                <p id="current-info">Aguardando sele√ß√£o...</p>
            </div>
        </div>
        <div class="player-controls">
            <button class="control-button" id="stop-button" aria-label="Parar reprodu√ß√£o">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square"><rect width="18" height="18" x="3" y="3" rx="2"/></svg>
            </button>
            <button class="control-button play-pause" id="play-pause-button" aria-label="Reproduzir ou pausar">
                <svg class="icon-play" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                <svg class="icon-pause" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
            </button>
            <div class="volume-control">
                <span id="volume-icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                </span>
                <input type="range" id="volume" min="0" max="1" step="0.1" value="0.7" aria-label="Controle de volume">
            </div>
        </div>
        <audio id="audio-player"></audio>
    </div>

    <div id="error-toast" class="error-toast">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle-alert"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
        <span id="error-message-text"></span>
    </div>

    <script>
        // --- CONSTANTES ---
        const API_BASE_URL = 'https://de1.api.radio-browser.info/json';
        const USER_AGENT = 'RadioOnlineWebApp/1.0 (seu_email@example.com)'; // Substitua pelo seu email/identificador
        const ITEMS_PER_PAGE = 20;
        const DEBOUNCE_DELAY = 500; // ms para debounce da pesquisa

        // --- REFER√äNCIAS DO DOM ---
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const favoritesButton = document.getElementById('favorites-button');
        const clearFiltersButton = document.getElementById('clear-filters-button');
        const countryFilter = document.getElementById('country-filter');
        const languageFilter = document.getElementById('language-filter');
        const tagFilter = document.getElementById('tag-filter');
        const sortOptions = document.getElementById('sort-options');
        const radioGrid = document.getElementById('radio-grid');
        const loading = document.getElementById('loading');
        const pagination = document.getElementById('pagination');
        const player = document.getElementById('player');
        const audioPlayer = document.getElementById('audio-player');
        const currentStation = document.getElementById('current-station');
        const currentInfo = document.getElementById('current-info');
        const stopButton = document.getElementById('stop-button');
        const volumeControl = document.getElementById('volume');
        const volumeIconContainer = document.getElementById('volume-icon-container');
        const playPauseButton = document.getElementById('play-pause-button');
        const errorToast = document.getElementById('error-toast');
        const errorToastText = document.getElementById('error-message-text');

        // --- ESTADO DA APLICA√á√ÉO ---
        let currentPage = 1;
        let totalStations = 0;
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let showingFavorites = false;
        let stations = []; // Array global para armazenar as esta√ß√µes da p√°gina atual
        let currentStationIndex = -1; // √çndice da esta√ß√£o atual na array 'stations'
        let currentPlayingCard = null; // Refer√™ncia √† radio-card atualmente tocando

        const filters = {
            name: '',
            country: '',
            language: '',
            tagList: '',
            order: 'name',
            reverse: false,
            offset: 0,
            limit: ITEMS_PER_PAGE,
            hidebroken: true
        };

        // --- FUN√á√ïES UTILIT√ÅRIAS ---

        /**
         * Adiciona um efeito de debounce a uma fun√ß√£o.
         * @param {function} func - A fun√ß√£o a ser debounced.
         * @param {number} delay - O tempo em milissegundos para esperar antes de chamar a fun√ß√£o.
         */
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        /**
         * Exibe uma mensagem de erro tempor√°ria na interface.
         * @param {string} message - A mensagem de erro a ser exibida.
         */
        function displayError(message) {
            errorToastText.textContent = message;
            errorToast.classList.add('active');
            setTimeout(() => {
                errorToast.classList.remove('active');
            }, 5000); // Esconde ap√≥s 5 segundos
        }

        /**
         * Fun√ß√£o espec√≠fica para exibir erros de reprodu√ß√£o de √°udio.
         * @param {string} message - A mensagem de erro de reprodu√ß√£o.
         */
        function displayPlaybackError(message) {
            displayError(`Erro de reprodu√ß√£o: ${message}`);
        }

        /**
         * Altera a visibilidade do spinner de carregamento.
         * @param {boolean} show - Verdadeiro para mostrar, falso para esconder.
         */
        function showLoading(show) {
            if (show) {
                loading.style.display = 'flex'; // Torna vis√≠vel para que a transi√ß√£o de opacidade funcione
                setTimeout(() => loading.classList.add('active'), 10);
                radioGrid.innerHTML = ''; // Limpa a grid enquanto carrega
                pagination.innerHTML = ''; // Limpa a pagina√ß√£o enquanto carrega
            } else {
                loading.classList.remove('active');
                setTimeout(() => {
                    loading.style.display = 'none'; // Esconde ap√≥s a transi√ß√£o
                }, 300); // Tempo da transi√ß√£o CSS
            }
        }

        /**
         * Exibe uma mensagem de "Nenhum resultado" na grid.
         * @param {string} message - A mensagem a ser exibida.
         */
        function showNoResultsMessage(message) {
            radioGrid.innerHTML = `
                <div class="no-results active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-frown"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>
                    <h3>${message}</h3>
                </div>
            `;
            pagination.innerHTML = ''; // Nenhuma pagina√ß√£o se n√£o h√° resultados
        }

        /**
         * Atualiza o √≠cone de volume com base no valor.
         * @param {number} volume - O valor do volume (0 a 1).
         */
        function updateVolumeIcon(volume) {
            let iconSvg = '';
            if (volume == 0) {
                iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-volume-x"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="22" x2="16" y1="9" y2="15"/><line x1="16" x2="22" y1="9" y2="15"/></svg>`;
            } else if (volume < 0.5) {
                iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-volume-1"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>`;
            } else {
                iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>`;
            }
            volumeIconContainer.innerHTML = iconSvg;
        }

        // --- L√ìGICA DA API ---

        /**
         * Faz requisi√ß√µes √† API RadioBrowser.
         * @param {string} endpoint - O endpoint da API (ex: '/countries', '/stations/search').
         * @param {object} params - Par√¢metros da query.
         * @returns {Promise<Array|object>} Os dados da resposta da API.
         */
        async function fetchData(endpoint, params = {}) {
            try {
                const url = new URL(`${API_BASE_URL}${endpoint}`);
                Object.entries(params).forEach(([key, value]) => {
                    if (value !== undefined && value !== null && value !== '') {
                        url.searchParams.append(key, value);
                    }
                });

                const response = await fetch(url.toString(), {
                    headers: { 'User-Agent': USER_AGENT }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    // MELHORIA: Incluindo a URL completa na mensagem de erro para depura√ß√£o
                    const errorMessage = `Erro na requisi√ß√£o da API (${response.status}) para URL: ${url.toString()}. Resposta: ${errorText || '(Sem resposta no corpo)'}`;
                    console.error(errorMessage); // Loga a mensagem detalhada para o console
                    throw new Error(errorMessage); // Lan√ßa a mensagem detalhada para ser exibida
                }

                return await response.json();
            } catch (error) {
                console.error('Erro ao buscar dados:', error);
                displayError(`Falha ao carregar dados: ${error.message}.`); // Agora error.message cont√©m a URL e resposta
                return [];
            }
        }

        /**
         * Registra um clique na esta√ß√£o via API (para contagem de popularidade).
         * @param {string} stationuuid - O UUID da esta√ß√£o.
         */
        async function trackStationClick(stationuuid) {
            try {
                // Endpoint para registrar um clique, apenas uma requisi√ß√£o HEAD ou GET leve
                await fetch(`${API_BASE_URL}/url/${stationuuid}`, {
                    method: 'HEAD', // Usar HEAD √© mais eficiente para apenas registrar
                    headers: { 'User-Agent': USER_AGENT }
                });
            } catch (error) {
                console.warn('Erro ao registrar clique (pode ser problema de rede ou CORS):', error);
                // N√£o exiba um erro cr√≠tico ao usu√°rio, pois isso √© secund√°rio
            }
        }

        // --- L√ìGICA DE FILTROS ---

        /**
         * Carrega e preenche os filtros de pa√≠s, idioma e g√™nero.
         */
        async function loadFilters() {
            try {
                // Melhoria: Usar Promise.all para carregar filtros em paralelo
                const [countries, languages, tags] = await Promise.all([
                    fetchData('/countries'),
                    fetchData('/languages'),
                    fetchData('/tags')
                ]);

                populateSelect(countryFilter, countries, 'name');
                populateSelect(languageFilter, languages, 'name');
                // Filtra tags com poucas esta√ß√µes e ordena por contagem
                populateSelect(tagFilter, tags.filter(tag => tag.name.trim() !== '' && tag.stationcount > 5)
                                            .sort((a, b) => b.stationcount - a.stationcount)
                                            .slice(0, 50), // Limita as 50 tags mais populares
                            'name');
                tagFilter.multiple = true; // Habilita multi-sele√ß√£o para tags

            } catch (error) {
                // displayError j√° √© chamado dentro de fetchData
                console.error("Erro ao carregar filtros:", error);
            }
        }

        /**
         * Preenche um elemento <select> com dados de uma array.
         * @param {HTMLSelectElement} selectElement - O elemento <select> a ser preenchido.
         * @param {Array<object>} data - Os dados para preencher as op√ß√µes.
         * @param {string} valueProperty - A propriedade do objeto a ser usada como valor e texto da op√ß√£o.
         */
        function populateSelect(selectElement, data, valueProperty) {
            selectElement.innerHTML = '';
            const firstOption = document.createElement('option');
            firstOption.value = '';
            // Ajusta o texto da primeira op√ß√£o dinamicamente
            let optionText = 'Todos';
            if (selectElement.id === 'country-filter') optionText += ' os Pa√≠ses';
            else if (selectElement.id === 'language-filter') optionText += ' os Idiomas';
            else if (selectElement.id === 'tag-filter') optionText += ' os G√™neros';

            firstOption.textContent = optionText;
            selectElement.appendChild(firstOption);

            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item[valueProperty];
                option.textContent = item[valueProperty] + (item.stationcount ? ` (${item.stationcount})` : '');
                selectElement.appendChild(option);
            });
        }

        /**
         * Atualiza o objeto `filters` com os valores atuais dos campos de entrada.
         */
        function updateFilters() {
            const selectedTags = Array.from(tagFilter.selectedOptions).map(option => option.value).join(',');

            filters.name = searchInput.value;
            filters.country = countryFilter.value;
            filters.language = languageFilter.value;
            filters.tagList = selectedTags;
            filters.order = sortOptions.value;
            filters.reverse = filters.order === 'votes' || filters.order === 'clicks' || filters.order === 'bitrate';
            filters.offset = (currentPage - 1) * ITEMS_PER_PAGE;
            filters.limit = ITEMS_PER_PAGE;
            filters.hidebroken = true;
        }

        /**
         * Limpa todos os filtros e a pesquisa, redefinindo o estado.
         */
        function clearAllFilters() {
            searchInput.value = '';
            countryFilter.value = '';
            languageFilter.value = '';
            // Desmarca todas as op√ß√µes de tags se for multi-sele√ß√£o
            Array.from(tagFilter.options).forEach(option => option.selected = false);
            tagFilter.value = ''; // Para garantir que a primeira op√ß√£o seja selecionada se n√£o for multi-sele√ß√£o
            sortOptions.value = 'name';

            // Reseta o estado de favoritos
            showingFavorites = false;
            favoritesButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg> Favoritos`;
            pagination.style.display = 'flex'; // Garante que a pagina√ß√£o apare√ßa

            currentPage = 1; // Reseta a p√°gina para a primeira
            updateFilters();
            searchStations();
        }

        // --- L√ìGICA PRINCIPAL DE PESQUISA ---

        /**
         * Busca esta√ß√µes com base nos filtros atuais e as exibe.
         */
        async function searchStations() {
            showLoading(true);

            if (showingFavorites) {
                displayFavorites();
                return;
            }

            try {
                // CORRE√á√ÉO DE BUG: Obter a contagem total de esta√ß√µes usando o endpoint /stations/search
                // com um limite alto, como no seu c√≥digo original.
                const countFiltersForTotal = { ...filters };
                delete countFiltersForTotal.offset; // Garante que a contagem seja do total, ignorando pagina√ß√£o
                countFiltersForTotal.limit = 100000; // Um limite alto para tentar pegar todas as esta√ß√µes filtradas para a contagem
                
                const allMatchingStationsForCount = await fetchData('/stations/search', countFiltersForTotal);
                totalStations = allMatchingStationsForCount.length;

                // Se n√£o houver esta√ß√µes, exibir mensagem e parar
                if (totalStations === 0) {
                    showNoResultsMessage('Nenhuma esta√ß√£o encontrada. Tente ajustar seus filtros de pesquisa.');
                    showLoading(false);
                    return;
                }

                // Obter as esta√ß√µes da p√°gina atual com os filtros de pagina√ß√£o
                const stationsData = await fetchData('/stations/search', filters);
                stations = stationsData; // Armazena as esta√ß√µes carregadas globalmente
                currentStationIndex = -1; // Resetar o √≠ndice da esta√ß√£o atual ao carregar nova lista

                displayStations(stations);
                updatePagination();

            } catch (error) {
                // displayError j√° √© chamado dentro de fetchData para erros de API
                showNoResultsMessage('Ocorreu um erro ao buscar esta√ß√µes. Por favor, tente novamente mais tarde.');
            } finally {
                showLoading(false);
            }
        }

        /**
         * Exibe as esta√ß√µes na grid.
         * @param {Array<object>} stationsToDisplay - A array de esta√ß√µes a serem exibidas.
         */
        function displayStations(stationsToDisplay) {
            radioGrid.innerHTML = '';
            if (stationsToDisplay.length === 0) {
                // Isso pode acontecer se houver um totalStations > 0, mas a p√°gina espec√≠fica estiver vazia
                // (caso incomum, mas poss√≠vel com bugs na API ou filters complexos)
                showNoResultsMessage('Nenhuma esta√ß√£o encontrada para a p√°gina atual.');
                return;
            }

            stationsToDisplay.forEach(station => {
                const card = createStationCard(station);
                radioGrid.appendChild(card);
            });

            // Re-destaca a esta√ß√£o atualmente tocando, se houver
            if (audioPlayer.src && currentPlayingCard) {
                // Remove o destaque da card anterior, se ainda estiver na DOM
                const prevPlayingCard = document.querySelector(`.radio-card.playing`);
                if(prevPlayingCard) {
                    prevPlayingCard.classList.remove('playing');
                }
                // Adiciona destaque √† nova card se ela existir na DOM atual
                const newPlayingCard = document.querySelector(`.radio-card[data-uuid="${currentPlayingCard.dataset.uuid}"]`);
                if (newPlayingCard) {
                    newPlayingCard.classList.add('playing');
                    currentPlayingCard = newPlayingCard; // Atualiza a refer√™ncia, caso a card tenha sido recriada
                } else {
                    currentPlayingCard = null; // A esta√ß√£o em reprodu√ß√£o n√£o est√° mais na tela
                }
            }
        }

        /**
         * Cria um card HTML para uma esta√ß√£o de r√°dio.
         * @param {object} station - Os dados da esta√ß√£o.
         * @returns {HTMLElement} O elemento HTML do card.
         */
        function createStationCard(station) {
            const card = document.createElement('div');
            card.className = 'radio-card';
            card.dataset.uuid = station.stationuuid; // Adiciona o UUID ao dataset do card para f√°cil refer√™ncia

            const isFavorite = favorites.includes(station.stationuuid);
            const favoriteClass = isFavorite ? 'favorite active' : 'favorite';

            // Limita a 3 tags e filtra tags vazias
            const tags = station.tags ? station.tags.split(',').map(tag => tag.trim()).filter(tag => tag !== '').slice(0, 3).map(tag => `<span class="tag">${tag}</span>`).join('') : '';

            card.innerHTML = `
                <div class="radio-image">
                    ${station.favicon ? `<img src="${station.favicon}" alt="Logo da ${station.name}" loading="lazy" onerror="this.onerror=null; this.src='https://via.placeholder.com/180x180/0f172a/e2e8f0?text=R√°dio';">` : `<img src="https://via.placeholder.com/180x180/0f172a/e2e8f0?text=R√°dio" alt="Logo padr√£o de r√°dio">`}
                </div>
                <div class="radio-info">
                    <h3 class="radio-name" title="${station.name}">${station.name}</h3>
                    <div class="radio-details">
                        <span>Pa√≠s: ${station.country || 'Desconhecido'}</span>
                        <span>Idioma: ${station.language || 'Desconhecido'}</span>
                        <div class="tags">${tags}</div>
                    </div>
                    <button class="${favoriteClass}" data-uuid="${station.stationuuid}" aria-label="${isFavorite ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}">
                        <svg class="icon-heart-empty" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                        <svg class="icon-heart-filled" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                    </button>
                </div>
                <div class="play-button"
                     data-url="${station.url_resolved || station.url}"
                     data-name="${station.name}"
                     data-info="${station.country || 'Pa√≠s Desconhecido'} - ${station.tags?.split(',')[0]?.trim() || 'Sem g√™nero'}"
                     data-uuid="${station.stationuuid}"
                     aria-label="Reproduzir esta√ß√£o ${station.name}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                </div>
            `;

            const playButton = card.querySelector('.play-button');
            playButton.addEventListener('click', () => {
                const stationData = {
                    url: playButton.dataset.url,
                    name: playButton.dataset.name,
                    info: playButton.dataset.info,
                    uuid: playButton.dataset.uuid
                };
                playStation(stationData);
            });

            const favoriteButton = card.querySelector('.favorite');
            favoriteButton.addEventListener('click', (e) => {
                e.stopPropagation(); // Evita que o clique se propague para o card inteiro (se tiver um evento no card)
                toggleFavorite(station.stationuuid, favoriteButton);
            });

            return card;
        }

        // --- L√ìGICA DE FAVORITOS ---

        /**
         * Alterna o estado de favorito de uma esta√ß√£o.
         * @param {string} uuid - O UUID da esta√ß√£o.
         * @param {HTMLElement} button - O bot√£o de favorito clicado.
         */
        function toggleFavorite(uuid, button) {
            const index = favorites.indexOf(uuid);

            if (index === -1) {
                favorites.push(uuid);
                button.classList.add('active');
                button.setAttribute('aria-label', 'Remover dos favoritos');
            } else {
                favorites.splice(index, 1);
                button.classList.remove('active');
                button.setAttribute('aria-label', 'Adicionar aos favoritos');

                if (showingFavorites) {
                    // Remove o card da visualiza√ß√£o de favoritos se ele for desfavoritado
                    const card = button.closest('.radio-card');
                    card.remove();
                    // Se a lista de favoritos ficar vazia, mostre a mensagem
                    if (favorites.length === 0) {
                        displayFavorites(); // Recarrega a mensagem de "nenhum favorito"
                    }
                }
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        /**
         * Exibe as esta√ß√µes favoritas do usu√°rio.
         */
        async function displayFavorites() {
            radioGrid.innerHTML = ''; // Limpa a grid
            showLoading(true);
            pagination.style.display = 'none'; // Esconde a pagina√ß√£o

            if (favorites.length === 0) {
                showNoResultsMessage('Nenhuma esta√ß√£o favorita. Adicione esta√ß√µes aos favoritos clicando no √≠cone de cora√ß√£o.');
                showLoading(false);
                return;
            }

            // Busca os detalhes completos das esta√ß√µes favoritas usando seus UUIDs
            try {
                // A API suporta m√∫ltiplos UUIDs separados por v√≠rgula
                const favoriteStationsData = await fetchData('/stations/byuuid', { uuids: favorites.join(',') });
                stations = favoriteStationsData; // Atualiza a lista global de esta√ß√µes para navega√ß√£o do player
                currentStationIndex = -1; // Resetar o √≠ndice
                displayStations(stations);
            } catch (error) {
                showNoResultsMessage('Erro ao carregar esta√ß√µes favoritas. Por favor, tente novamente mais tarde.');
            } finally {
                showLoading(false);
            }
        }

        // --- L√ìGICA DO PLAYER DE √ÅUDIO ---

        /**
         * Reproduz uma esta√ß√£o de r√°dio.
         * @param {object} stationData - Objeto contendo url, name, info e uuid da esta√ß√£o.
         */
        function playStation(stationData) {
            const { url, name, info, uuid } = stationData;

            // Encontra o √≠ndice da esta√ß√£o na lista atual de esta√ß√µes
            // Usamos findIndex para garantir que o currentStationIndex est√° sempre atualizado com a lista 'stations'
            let foundIndex = stations.findIndex(s => s.stationuuid === uuid);
            if (foundIndex === -1) {
                // Se a esta√ß√£o n√£o estiver na lista atual (ex: pesquisa nova ou favoritos), adicione-a temporariamente
                // Isso pode acontecer se o usu√°rio clicar em uma esta√ß√£o que n√£o est√° na `stations` carregada
                console.warn('Esta√ß√£o clicada n√£o est√° na lista atual de esta√ß√µes carregadas. Adicionando temporariamente.');
                stations.push(stationData);
                currentStationIndex = stations.length - 1;
            } else {
                currentStationIndex = foundIndex;
            }


            audioPlayer.src = url;
            audioPlayer.volume = parseFloat(volumeControl.value); // Garante que seja um n√∫mero

            // Remover destaque da esta√ß√£o anterior
            if (currentPlayingCard) {
                currentPlayingCard.classList.remove('playing');
            }

            // Adicionar destaque √† esta√ß√£o atual
            // Usamos `data-uuid` para encontrar o card, que √© adicionado em `createStationCard`
            const newPlayingCard = document.querySelector(`.radio-card[data-uuid="${uuid}"]`);
            if (newPlayingCard) {
                newPlayingCard.classList.add('playing');
                currentPlayingCard = newPlayingCard;
            } else {
                currentPlayingCard = null; // Reset se a card n√£o estiver na DOM
            }

            audioPlayer.play()
                .then(() => {
                    currentStation.textContent = name;
                    currentInfo.textContent = info;
                    player.classList.add('active');
                    playPauseButton.classList.add('playing'); // Mudar para √≠cone de pausa
                    trackStationClick(uuid); // Registra o clique
                })
                .catch(error => {
                    displayPlaybackError(`N√£o foi poss√≠vel reproduzir "${name}". A esta√ß√£o pode estar offline ou o formato n√£o √© suportado. Detalhes: ${error.message}`);
                    console.error('Erro ao tentar reproduzir a esta√ß√£o:', error);
                    // Opcional: Tentar a pr√≥xima esta√ß√£o automaticamente ap√≥s erro
                    // playNextStation();
                });
        }

        /**
         * Tenta reproduzir a pr√≥xima esta√ß√£o na lista.
         */
        async function playNextStation() {
            // Se estivermos na √∫ltima esta√ß√£o da lista atual
            if (stations && currentStationIndex >= 0 && currentStationIndex < stations.length - 1) {
                currentStationIndex++;
                const nextStation = stations[currentStationIndex];
                playStation({
                    url: nextStation.url_resolved || nextStation.url,
                    name: nextStation.name,
                    info: `${nextStation.country || 'Desconhecido'} - ${nextStation.tags?.split(',')[0]?.trim() || 'Sem g√™nero'}`,
                    uuid: nextStation.stationuuid
                });
            } else {
                // Se chegou ao fim da lista da p√°gina atual, tentar carregar a pr√≥xima p√°gina
                const totalPages = Math.ceil(totalStations / ITEMS_PER_PAGE);
                if (!showingFavorites && currentPage < totalPages) {
                    currentPage++;
                    updateFilters(); // Atualiza os filtros para a pr√≥xima p√°gina
                    showLoading(true); // Mostrar carregamento enquanto busca a pr√≥xima p√°gina
                    await searchStations(); // Carrega as novas esta√ß√µes

                    // Certifique-se de que `stations` foi preenchido por `searchStations`
                    if (stations && stations.length > 0) {
                        currentStationIndex = 0; // Come√ßa da primeira esta√ß√£o da nova p√°gina
                        const nextStation = stations[currentStationIndex];
                        playStation({
                            url: nextStation.url_resolved || nextStation.url,
                            name: nextStation.name,
                            info: `${nextStation.country || 'Desconhecido'} - ${nextStation.tags?.split(',')[0]?.trim() || 'Sem g√™nero'}`,
                            uuid: nextStation.stationuuid
                        });
                    } else {
                        displayPlaybackError('N√£o h√° mais esta√ß√µes dispon√≠veis para reprodu√ß√£o nas pr√≥ximas p√°ginas.');
                        stopButton.click();
                    }
                } else {
                    // Chegou ao fim de todas as esta√ß√µes dispon√≠veis ou dos favoritos
                    displayPlaybackError('Voc√™ chegou ao final da lista de esta√ß√µes.');
                    stopButton.click();
                }
            }
        }

        // --- L√ìGICA DE PAGINA√á√ÉO ---

        /**
         * Atualiza os bot√µes da pagina√ß√£o com base na p√°gina atual e total de esta√ß√µes.
         */
        function updatePagination() {
            pagination.innerHTML = '';
            const totalPages = Math.ceil(totalStations / ITEMS_PER_PAGE);

            if (totalPages <= 1) {
                pagination.style.display = 'none'; // Esconde se n√£o houver pagina√ß√£o
                return;
            }

            pagination.style.display = 'flex'; // Garante que esteja vis√≠vel

            const prevBtn = createPaginationButton('¬´ Anterior', () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateFilters();
                    searchStations();
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Rola para o topo
                }
            }, 'P√°gina anterior');
            prevBtn.disabled = currentPage === 1;
            pagination.appendChild(prevBtn);

            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4); // Mostra no m√°ximo 5 bot√µes de p√°gina

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = createPaginationButton(i, () => {
                    currentPage = i;
                    updateFilters();
                    searchStations();
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Rola para o topo
                }, `P√°gina ${i}`);
                pageBtn.classList.toggle('active', i === currentPage);
                pagination.appendChild(pageBtn);
            }

            const nextBtn = createPaginationButton('Pr√≥ximo ¬ª', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateFilters();
                    searchStations();
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Rola para o topo
                }
            }, 'Pr√≥xima p√°gina');
            nextBtn.disabled = currentPage === totalPages;
            pagination.appendChild(nextBtn);
        }

        /**
         * Cria um bot√£o de pagina√ß√£o.
         * @param {string|number} text - O texto ou n√∫mero do bot√£o.
         * @param {Function} onClick - A fun√ß√£o a ser executada ao clicar.
         * @param {string} ariaLabel - O r√≥tulo de acessibilidade do bot√£o.
         * @returns {HTMLButtonElement} O bot√£o criado.
         */
        function createPaginationButton(text, onClick, ariaLabel) {
            const button = document.createElement('button');
            button.textContent = text;
            button.addEventListener('click', onClick);
            button.setAttribute('aria-label', ariaLabel);
            return button;
        }

        // --- LISTENERS DE EVENTOS ---

        // Pesquisa (debounce para input, click para button)
        // Usamos debounce para o input do usu√°rio para evitar muitas requisi√ß√µes
        searchInput.addEventListener('input', debounce(() => {
            if (!showingFavorites) {
                currentPage = 1; // Sempre volta para a primeira p√°gina ao pesquisar
                updateFilters();
                searchStations();
            }
        }, DEBOUNCE_DELAY));

        searchButton.addEventListener('click', () => {
            currentPage = 1;
            showingFavorites = false; // Garante que n√£o est√° mostrando favoritos
            favoritesButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg> Favoritos`;
            pagination.style.display = 'flex'; // Garante que a pagina√ß√£o apare√ßa
            updateFilters();
            searchStations();
        });

        // Alternar Favoritos
        favoritesButton.addEventListener('click', () => {
            showingFavorites = !showingFavorites;
            if (showingFavorites) {
                favoritesButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radio"><circle cx="12" cy="12" r="2"/><path d="M4.93 19.07A10 10 0 0 1 12 22v-2A8 8 0 0 0 6.34 17.66"/><path d="M19.07 4.93A10 10 0 0 1 12 2v2A8 8 0 0 0 17.66 6.34"/><path d="M4.93 4.93A16 16 0 0 1 12 2v2A14 14 0 0 0 6.34 6.34"/><path d="M19.07 19.07A16 16 0 0 0 12 22v-2A14 14 0 0 1 17.66 17.66"/></svg> Todas as Esta√ß√µes`;
                displayFavorites();
            } else {
                favoritesButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg> Favoritos`;
                currentPage = 1; // Reseta a p√°gina ao voltar para "Todas as Esta√ß√µes"
                updateFilters();
                searchStations();
                pagination.style.display = 'flex'; // Garante que a pagina√ß√£o apare√ßa
            }
        });

        // Limpar Filtros
        clearFiltersButton.addEventListener('click', clearAllFilters);

        // Filtros (Pa√≠s, Idioma, G√™nero, Ordem)
        [countryFilter, languageFilter, tagFilter, sortOptions].forEach(filter => {
            filter.addEventListener('change', () => {
                if (!showingFavorites) {
                    currentPage = 1;
                    updateFilters();
                    searchStations();
                }
            });
        });

        // Controles do Player
        playPauseButton.addEventListener('click', () => {
            if (audioPlayer.paused) {
                if (audioPlayer.src) { // S√≥ tenta tocar se houver uma URL
                    audioPlayer.play();
                    playPauseButton.classList.add('playing');
                } else if (stations && stations.length > 0) {
                    // Se n√£o houver nada tocando, mas tiver esta√ß√µes na lista, toca a primeira
                    // Ou a √∫ltima esta√ß√£o clicada, se `currentStationIndex` for v√°lido
                    const stationToPlay = stations[currentStationIndex !== -1 ? currentStationIndex : 0];
                    if (stationToPlay) {
                        playStation({
                            url: stationToPlay.url_resolved || stationToPlay.url,
                            name: stationToPlay.name,
                            info: `${stationToPlay.country || 'Desconhecido'} - ${stationToPlay.tags?.split(',')[0]?.trim() || 'Sem g√™nero'}`,
                            uuid: stationToPlay.stationuuid
                        });
                    }
                } else {
                    displayError('Nenhuma esta√ß√£o selecionada para reprodu√ß√£o. Pesquise e clique em uma esta√ß√£o.');
                }
            } else {
                audioPlayer.pause();
                playPauseButton.classList.remove('playing');
            }
        });

        stopButton.addEventListener('click', () => {
            audioPlayer.pause();
            audioPlayer.src = ''; // Limpa a fonte do √°udio
            player.classList.remove('active');
            playPauseButton.classList.remove('playing'); // Mudar para √≠cone de play
            currentStation.textContent = 'Nenhuma esta√ß√£o tocando';
            currentInfo.textContent = 'Aguardando sele√ß√£o...';

            if (currentPlayingCard) {
                currentPlayingCard.classList.remove('playing');
                currentPlayingCard = null;
            }
            currentStationIndex = -1; // Reseta o √≠ndice
        });

        volumeControl.addEventListener('input', () => {
            audioPlayer.volume = parseFloat(volumeControl.value);
            localStorage.setItem('playerVolume', volumeControl.value);
            updateVolumeIcon(audioPlayer.volume);
        });

        // Evento de erro do player de √°udio
        audioPlayer.onerror = (e) => {
            console.error('Erro de √°udio:', e);
            displayPlaybackError('A reprodu√ß√£o falhou. A esta√ß√£o pode estar offline ou o formato n√£o √© suportado.');
            // Opcional: tentar a pr√≥xima esta√ß√£o automaticamente
            // playNextStation();
        };

        // Evento quando a esta√ß√£o atual termina (para avan√ßar para a pr√≥xima)
        audioPlayer.onended = playNextStation;


        // --- INICIALIZA√á√ÉO DA APLICA√á√ÉO ---
        window.addEventListener('load', () => {
            // Carregar filtros e dados iniciais
            loadFilters();
            updateFilters(); // Aplica filtros iniciais
            searchStations(); // Realiza a primeira pesquisa

            // Inicializa o volume do player
            const savedVolume = localStorage.getItem('playerVolume');
            if (savedVolume !== null) {
                volumeControl.value = parseFloat(savedVolume);
            }
            audioPlayer.volume = parseFloat(volumeControl.value);
            updateVolumeIcon(audioPlayer.volume);
        });

        // Opcional: Fun√ß√£o para converter √≠cones Lucide automaticamente
        // Garante que os √≠cones SVG sejam processados se adicionados dinamicamente
        function replaceLucideIcons() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        // Chame isso ap√≥s adicionar elementos dinamicamente, se necess√°rio.
        // Por exemplo, ap√≥s displayStations(stations);
        // N√£o √© necess√°rio para SVGs inclu√≠dos diretamente no HTML, apenas se criados por JS.
    </script>
</body>
</html>
